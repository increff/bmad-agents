# WSSI-MFP Workflow Template
# Template for WSSI (Weekly Sales & Stock Intelligence) to MFP (Monthly Forecast Planning) workflow
# Phoenix environment-specific implementation

name: "wssi-mfp-workflow-template"
version: "1.0.0"
description: "Template for WSSI to MFP workflow in Phoenix environment"

# Environment Configuration
environment: "phoenix"
base_branches:
  irisx-algo: "master-adidas-reliance-prod"
  ms-mfp: "release-pheonix"
  irisx-config: "master-adidas-ril"
  ms-loadapis: "caas-pheonix-uploads"

# LoadAPIs Configuration
loadapis_config:
  data_sources:
    - name: "loadapis_upload_data"
      description: "LoadAPIs upload data from caas-pheonix-uploads"
      format: "csv"
      location: "data/loadapis/uploads"
    
    - name: "loadapis_processing_data"
      description: "LoadAPIs processing data"
      format: "json"
      location: "data/loadapis/processing"
    
    - name: "loadapis_validation_data"
      description: "LoadAPIs validation data"
      format: "csv"
      location: "data/loadapis/validation"

  data_loading:
    - name: "upload_processing"
      description: "Upload processing workflow"
      steps:
        - "data_ingestion"
        - "data_validation"
        - "data_transformation"
        - "data_quality_check"
    
    - name: "batch_processing"
      description: "Batch processing workflow"
      steps:
        - "batch_creation"
        - "batch_validation"
        - "batch_processing"
        - "batch_completion"

  phoenix_specific:
    - name: "phoenix_upload_rules"
      description: "Phoenix-specific upload rules"
      rules:
        - "upload_size_limit: 100MB"
        - "upload_format: csv, json, xlsx"
        - "upload_validation: strict"
    
    - name: "phoenix_processing_rules"
      description: "Phoenix-specific processing rules"
      rules:
        - "processing_timeout: 300 seconds"
        - "memory_limit: 8GB"
        - "concurrent_uploads: 10"

# WSSI Configuration
wssi_config:
  data_sources:
    - name: "wssi_channel_output"
      description: "WSSI channel output data"
      format: "csv"
      location: "data/wssi/channel_output"
    
    - name: "wssi_periods"
      description: "WSSI periods configuration"
      format: "csv"
      location: "data/wssi/periods"
    
    - name: "wssi_filters"
      description: "WSSI filter configurations"
      format: "json"
      location: "config/wssi/filters"

  kpi_groups:
    sales_rev:
      - "act_proj_sales_rev"
      - "ly_sales_rev"
      - "aop_sales_rev"
      - "change_over_ly_sales_rev"
      - "achievement_against_aop_sales_rev"
    
    sales_qty:
      - "act_proj_sales_qty"
      - "ly_sales_qty"
      - "aop_sales_qty"
      - "change_over_ly_sales_qty"
      - "achievement_against_aop_sales_qty"
    
    inv_qty:
      - "act_proj_inv_qty"
      - "target_inv_qty"
      - "ly_inv_qty"
      - "change_over_ly_inv_qty"
    
    cover_duration:
      - "act_proj_cover_duration"
      - "target_cover_duration"
      - "ly_cover_duration"
      - "change_over_ly_cover_duration"
    
    inwards:
      - "git_inwards"
      - "otb_inwards"
      - "forced_inwards"
    
    inv_cogs:
      - "act_proj_inv_cogs"
      - "ly_inv_cogs"
      - "change_over_ly_inv_cogs"
    
    inwards_cogs:
      - "act_proj_inwards_cogs"

  subperiods:
    - name: "w1"
      period: "january"
      is_actual: true
    - name: "w2"
      period: "january"
      is_actual: true
    - name: "w3"
      period: "january"
      is_actual: false
    - name: "w4"
      period: "january"
      is_actual: false
    - name: "w5"
      period: "february"
      is_actual: false
    - name: "w6"
      period: "february"
      is_actual: false
    - name: "w7"
      period: "february"
      is_actual: false
    - name: "w8"
      period: "february"
      is_actual: false
    - name: "w9"
      period: "march"
      is_actual: false
    - name: "w10"
      period: "march"
      is_actual: false
    - name: "w11"
      period: "march"
      is_actual: false
    - name: "w12"
      period: "march"
      is_actual: false
    - name: "w13"
      period: "april"
      is_actual: false
    - name: "w14"
      period: "april"
      is_actual: false
    - name: "w15"
      period: "april"
      is_actual: false
    - name: "w16"
      period: "april"
      is_actual: false
    - name: "w17"
      period: "may"
      is_actual: false
    - name: "w18"
      period: "may"
      is_actual: false

  filters:
    channel:
      key: "channel"
      label: "Format"
      values: ["online", "offline", "wholesale", "retail"]
    
    fashion_grade:
      key: "fashion_grade"
      label: "Fashion Grade"
      values: ["A", "B", "C", "D"]
    
    brand_segment:
      key: "brand_segment"
      label: "Segment"
      values: ["premium", "mass", "value"]
    
    brand:
      key: "brand"
      label: "Brand"
      values: ["brand1", "brand2", "brand3"]
    
    sales_channel:
      key: "sales_channel"
      label: "Sales Channel"
      values: ["direct", "indirect", "online", "offline"]

# MFP Configuration
mfp_config:
  views:
    overall_view:
      name: "overall_view"
      description: "MFP overall view with aggregated data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      aggregations: ["sum", "mean", "count"]
    
    channel_view:
      name: "channel_view"
      description: "MFP channel view with channel-specific data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["channel"]
      aggregations: ["sum", "mean", "count"]
    
    cat_view:
      name: "cat_view"
      description: "MFP category view with category-specific data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["cat"]
      aggregations: ["sum", "mean", "count"]
    
    channel_cat_view:
      name: "channel_cat_view"
      description: "MFP channel-category view with combined data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["channel", "cat"]
      aggregations: ["sum", "mean", "count"]
    
    cat_channel_view:
      name: "cat_channel_view"
      description: "MFP category-channel view with combined data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["cat", "channel"]
      aggregations: ["sum", "mean", "count"]
    
    store_view:
      name: "store_view"
      description: "MFP store view with store-specific data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["store"]
      aggregations: ["sum", "mean", "count"]
    
    store_cat_view:
      name: "store_cat_view"
      description: "MFP store-category view with combined data"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["store", "cat"]
      aggregations: ["sum", "mean", "count"]

  snapshots:
    channel_cat_month_kpi:
      name: "channel_cat_month_kpi"
      description: "Channel-category monthly KPI snapshot"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["channel", "cat"]
      time_dimension: "month"
    
    store_subcat_month_kpi:
      name: "store_subcat_month_kpi"
      description: "Store-subcategory monthly KPI snapshot"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["store", "subcat"]
      time_dimension: "month"
    
    store_cat_month_kpi:
      name: "store_cat_month_kpi"
      description: "Store-category monthly KPI snapshot"
      kpis: ["gsv", "asp", "growth_factor", "seasonality"]
      group_by: ["store", "cat"]
      time_dimension: "month"

  kpis:
    gsv:
      name: "gsv"
      description: "Gross Sales Value"
      calculation: "sum(sales_rev)"
      aggregation: "sum"
    
    asp:
      name: "asp"
      description: "Average Selling Price"
      calculation: "sum(sales_rev) / sum(sales_qty)"
      aggregation: "mean"
    
    growth_factor:
      name: "growth_factor"
      description: "Growth Factor"
      calculation: "current_period / previous_period"
      aggregation: "mean"
    
    seasonality:
      name: "seasonality"
      description: "Seasonality Factor"
      calculation: "period_average / overall_average"
      aggregation: "mean"

# Phoenix Environment Configuration
phoenix_config:
  environment_specific:
    data_sources:
      - name: "phoenix_wssi_data"
        description: "Phoenix-specific WSSI data"
        format: "csv"
        location: "data/phoenix/wssi"
      
      - name: "phoenix_mfp_data"
        description: "Phoenix-specific MFP data"
        format: "csv"
        location: "data/phoenix/mfp"
    
    business_rules:
      - name: "phoenix_kpi_calculation"
        description: "Phoenix-specific KPI calculation rules"
        rules:
          - "gsv_calculation: sum(sales_rev) * phoenix_factor"
          - "asp_calculation: (sum(sales_rev) / sum(sales_qty)) * phoenix_multiplier"
          - "growth_factor: (current_period / previous_period) * phoenix_adjustment"
      
      - name: "phoenix_validation_rules"
        description: "Phoenix-specific validation rules"
        rules:
          - "gsv_validation: gsv > 0"
          - "asp_validation: asp > 0"
          - "growth_factor_validation: growth_factor >= 0"
    
    constraints:
      - name: "phoenix_performance_constraints"
        description: "Phoenix-specific performance constraints"
        constraints:
          - "max_processing_time: 300 seconds"
          - "max_memory_usage: 8GB"
          - "max_concurrent_requests: 100"
      
      - name: "phoenix_data_constraints"
        description: "Phoenix-specific data constraints"
        constraints:
          - "max_data_size: 1TB"
          - "max_records_per_batch: 1000000"
          - "max_columns_per_view: 1000"

# Cross-Repository Integration Configuration
integration_config:
  algorithm_repository:
    business_logic:
      - name: "kpi_calculation_logic"
        description: "KPI calculation business logic"
        location: "irisx-algo/src/main/java/com/increff/irisx/module"
        modules:
          - "KpiCalculationModule"
          - "AggregationModule"
          - "ValidationModule"
    
    calculation_modules:
      - name: "gsv_calculation"
        description: "GSV calculation module"
        location: "irisx-algo/src/main/java/com/increff/irisx/module/calculation"
        class: "GsvCalculationModule"
      
      - name: "asp_calculation"
        description: "ASP calculation module"
        location: "irisx-algo/src/main/java/com/increff/irisx/module/calculation"
        class: "AspCalculationModule"
      
      - name: "growth_factor_calculation"
        description: "Growth factor calculation module"
        location: "irisx-algo/src/main/java/com/increff/irisx/module/calculation"
        class: "GrowthFactorCalculationModule"

  configuration_repository:
    sql_views:
      - name: "wssi_channel_output_view"
        description: "WSSI channel output SQL view"
        location: "irisx-config/view-creation/child-input-wssi_channel_output.sql"
        type: "child-input"
      
      - name: "mfp_overall_view"
        description: "MFP overall view SQL view"
        location: "irisx-config/view-creation/child-output-mfp_overall_view.sql"
        type: "child-output"
      
      - name: "mfp_channel_view"
        description: "MFP channel view SQL view"
        location: "irisx-config/view-creation/child-output-mfp_channel_view.sql"
        type: "child-output"
    
    templates:
      - name: "wssi_input_template"
        description: "WSSI input template"
        location: "irisx-config/template/export_wssi_input_template.tsv"
        format: "tsv"
      
      - name: "mfp_output_template"
        description: "MFP output template"
        location: "irisx-config/template/export_mfp_output_template.tsv"
        format: "tsv"

  loadapis_repository:
    routes:
      - name: "loadapis_upload_routes"
        description: "LoadAPIs upload routes"
        location: "ms-loadapis/loadapis/routes/upload_routes.py"
        endpoints:
          - "/upload"
          - "/upload/validate"
          - "/upload/process"
          - "/upload/status"
      
      - name: "loadapis_data_routes"
        description: "LoadAPIs data routes"
        location: "ms-loadapis/loadapis/routes/data_routes.py"
        endpoints:
          - "/data/load"
          - "/data/validate"
          - "/data/transform"
          - "/data/export"
    
    services:
      - name: "loadapis_upload_service"
        description: "LoadAPIs upload service"
        location: "ms-loadapis/loadapis/service/upload_service.py"
        functions:
          - "process_upload"
          - "validate_upload"
          - "transform_upload"
          - "export_upload"
      
      - name: "loadapis_data_service"
        description: "LoadAPIs data service"
        location: "ms-loadapis/loadapis/service/data_service.py"
        functions:
          - "load_data"
          - "validate_data"
          - "transform_data"
          - "export_data"

  mfp_repository:
    routes:
      - name: "mfp_views_routes"
        description: "MFP views routes"
        location: "ms-mfp/mfp/routes/mfp_views_routes.py"
        endpoints:
          - "/overall_view"
          - "/channel_view"
          - "/cat_view"
          - "/channel_cat_view"
          - "/cat_channel_view"
          - "/store_view"
          - "/store_cat_view"
      
      - name: "wssi_views_routes"
        description: "WSSI views routes"
        location: "ms-mfp/mfp/routes/wssi_views_routes.py"
        endpoints:
          - "/wssi_view"
          - "/subperiods"
          - "/filters"
    
    services:
      - name: "mfp_views_helper"
        description: "MFP views helper service"
        location: "ms-mfp/mfp/service/mfp_views_helper.py"
        functions:
          - "create_overall_view"
          - "create_channel_view"
          - "create_cat_view"
          - "create_channel_cat_view"
          - "create_cat_channel_view"
          - "create_store_view"
          - "create_store_cat_view"
      
      - name: "wssi_views_helper"
        description: "WSSI views helper service"
        location: "ms-mfp/mfp/service/wssi_views_helper.py"
        functions:
          - "create_wssi_view"
          - "get_subperiods"
          - "get_all_filters"

# Quality Assurance Configuration
quality_assurance:
  data_validation:
    loadapis_data:
      - name: "data_completeness"
        description: "LoadAPIs data completeness validation"
        rules:
          - "all_required_columns_present"
          - "no_null_values_in_key_columns"
          - "data_range_validation"
      
      - name: "data_accuracy"
        description: "LoadAPIs data accuracy validation"
        rules:
          - "numeric_columns_are_numeric"
          - "date_columns_are_valid_dates"
          - "upload_validation_rules_applied"
      
      - name: "data_consistency"
        description: "LoadAPIs data consistency validation"
        rules:
          - "upload_data_consistency"
          - "processing_data_consistency"
          - "validation_data_consistency"
    
    wssi_data:
      - name: "data_completeness"
        description: "WSSI data completeness validation"
        rules:
          - "all_required_columns_present"
          - "no_null_values_in_key_columns"
          - "data_range_validation"
      
      - name: "data_accuracy"
        description: "WSSI data accuracy validation"
        rules:
          - "numeric_columns_are_numeric"
          - "date_columns_are_valid_dates"
          - "kpi_calculations_are_correct"
      
      - name: "data_consistency"
        description: "WSSI data consistency validation"
        rules:
          - "kpi_values_are_consistent"
          - "subperiod_data_is_consistent"
          - "filter_values_are_consistent"
    
    mfp_data:
      - name: "view_accuracy"
        description: "MFP view accuracy validation"
        rules:
          - "view_data_matches_source_data"
          - "aggregations_are_correct"
          - "kpi_calculations_are_accurate"
      
      - name: "snapshot_integrity"
        description: "MFP snapshot integrity validation"
        rules:
          - "snapshot_data_is_complete"
          - "snapshot_data_is_consistent"
          - "snapshot_versioning_is_correct"
      
      - name: "performance_validation"
        description: "MFP performance validation"
        rules:
          - "view_generation_time_acceptable"
          - "snapshot_creation_time_acceptable"
          - "memory_usage_acceptable"

  integration_validation:
    cross_repository:
      - name: "data_flow_integrity"
        description: "Cross-repository data flow integrity validation"
        rules:
          - "data_flows_correctly_between_repositories"
          - "data_transformations_are_correct"
          - "data_consistency_maintained"
      
      - name: "business_logic_integration"
        description: "Business logic integration validation"
        rules:
          - "business_logic_applied_correctly"
          - "calculation_modules_integrated"
          - "validation_rules_applied"
      
      - name: "performance_integration"
        description: "Performance integration validation"
        rules:
          - "integration_performance_acceptable"
          - "scalability_requirements_met"
          - "resource_usage_optimized"

  phoenix_validation:
    environment_compliance:
      - name: "phoenix_rules_compliance"
        description: "Phoenix environment rules compliance validation"
        rules:
          - "phoenix_business_rules_applied"
          - "phoenix_constraints_respected"
          - "phoenix_performance_requirements_met"
      
      - name: "phoenix_data_compliance"
        description: "Phoenix data compliance validation"
        rules:
          - "phoenix_data_formats_respected"
          - "phoenix_data_validation_rules_applied"
          - "phoenix_data_quality_standards_met"

# Success Criteria Configuration
success_criteria:
  technical:
    - name: "loadapis_data_loading_success"
      description: "LoadAPIs data successfully loaded and processed"
      criteria:
        - "loadapis_data_loaded_successfully"
        - "loadapis_data_quality_validated"
        - "loadapis_data_processing_completed"
        - "loadapis_data_transformation_successful"
    
    - name: "wssi_standardization_success"
      description: "WSSI data successfully standardized for MFP compatibility"
      criteria:
        - "wssi_data_format_standardized"
        - "wssi_kpi_calculations_standardized"
        - "wssi_subperiods_standardized"
        - "wssi_filters_standardized"
    
    - name: "mfp_implementation_success"
      description: "MFP views and snapshots generated correctly"
      criteria:
        - "mfp_views_generated_correctly"
        - "mfp_snapshots_created_correctly"
        - "mfp_data_quality_acceptable"
        - "mfp_performance_acceptable"
    
    - name: "cross_repository_integration_success"
      description: "Cross-repository integration working seamlessly"
      criteria:
        - "algorithm_repository_integrated"
        - "configuration_repository_integrated"
        - "mfp_repository_integrated"
        - "data_flow_working_correctly"
    
    - name: "phoenix_compliance_success"
      description: "Phoenix environment compliance maintained"
      criteria:
        - "phoenix_business_rules_applied"
        - "phoenix_constraints_respected"
        - "phoenix_performance_requirements_met"
        - "phoenix_data_quality_standards_met"

  business:
    - name: "loadapis_requirements_success"
      description: "LoadAPIs requirements fully addressed"
      criteria:
        - "loadapis_data_requirements_met"
        - "loadapis_upload_requirements_met"
        - "loadapis_processing_requirements_met"
        - "loadapis_validation_requirements_met"
    
    - name: "wssi_requirements_success"
      description: "WSSI requirements fully addressed"
      criteria:
        - "wssi_data_requirements_met"
        - "wssi_kpi_requirements_met"
        - "wssi_subperiod_requirements_met"
        - "wssi_filter_requirements_met"
    
    - name: "mfp_capabilities_success"
      description: "MFP forecasting capabilities enhanced"
      criteria:
        - "mfp_forecasting_accuracy_improved"
        - "mfp_forecasting_speed_improved"
        - "mfp_forecasting_flexibility_improved"
        - "mfp_forecasting_reliability_improved"
    
    - name: "phoenix_business_rules_success"
      description: "Phoenix-specific business rules implemented"
      criteria:
        - "phoenix_business_logic_applied"
        - "phoenix_calculation_rules_applied"
        - "phoenix_validation_rules_applied"
        - "phoenix_performance_rules_applied"
    
    - name: "user_experience_success"
      description: "User experience improved"
      criteria:
        - "user_interface_improved"
        - "user_workflow_improved"
        - "user_performance_improved"
        - "user_satisfaction_improved"

  quality:
    - name: "quality_gates_success"
      description: "All quality gates passed"
      criteria:
        - "wssi_quality_gate_passed"
        - "mfp_quality_gate_passed"
        - "integration_quality_gate_passed"
        - "phoenix_quality_gate_passed"
    
    - name: "testing_success"
      description: "Comprehensive testing completed"
      criteria:
        - "unit_testing_completed"
        - "integration_testing_completed"
        - "end_to_end_testing_completed"
        - "performance_testing_completed"
    
    - name: "documentation_success"
      description: "Documentation complete and accurate"
      criteria:
        - "technical_documentation_complete"
        - "user_guides_complete"
        - "api_documentation_complete"
        - "configuration_guides_complete"
    
    - name: "performance_success"
      description: "Performance requirements satisfied"
      criteria:
        - "response_time_requirements_met"
        - "throughput_requirements_met"
        - "scalability_requirements_met"
        - "resource_usage_requirements_met"
